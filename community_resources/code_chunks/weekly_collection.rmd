---
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r, echo=FALSE, message = FALSE, warnings = FALSE}
library(tidyverse)

#df <- readr::read_rds("2019-02-17_tidy_tuesday_tweets.rds")
df <- rtweet::search_tweets("#tidytuesday", n = 18000, include_rts = FALSE)

clean_df <- df %>% 
  filter(is_retweet == "FALSE") %>% 
  filter(!str_detect(tolower(text), "tidyingup")) %>% 
  select(screen_name, created_at, text, pic = ext_media_url)  %>% 
  unnest(pic) %>% 
  mutate(text = str_replace_all(text, '#', '`#`')) %>% 
  group_by(screen_name, text) %>% 
  mutate(row_n = paste0("pic_", row_number())) %>% 
  spread(row_n, pic) %>% 
  filter(!is.na(pic_1)) %>% 
    arrange(created_at) %>% 
  filter(!str_detect(text, "The @R4DScommunity welcomes you to week"))

keypost_df <- df %>% 
  filter(is_retweet == "FALSE") %>% 
  filter(!str_detect(tolower(text), "tidyingup")) %>% 
  select(screen_name, created_at, text, pic = ext_media_url)  %>% 
  unnest(pic) %>% 
  mutate(text = str_replace_all(text, '#', '`#`')) %>% 
  group_by(screen_name, text) %>% 
  mutate(row_n = paste0("pic_", row_number())) %>% 
  spread(row_n, pic) %>% 
  filter(!is.na(pic_1)) %>% 
    arrange(created_at) %>% 
  filter(str_detect(text, "The @R4DScommunity welcomes you to week"))

week_num <- keypost_df %>% 
  pull(text) %>% 
  word(7, 7) %>% 
  as.numeric()

```

```{r, echo=FALSE, results = 'asis'}
cat(paste0("# ",  "`#TidyTuesday` Tweets for week ", 
           week_num,
           "  \n\n"))
```


The `#TidyTuesday` tweets included here are ones that included at least one image, and are arranged by submission date. Many thanks to the `r nrow(clean_df)`(!) people who submitted!! This page has been autogenerated as of `r Sys.Date()` and we hope you enjoy any random "house-cleaning" tips that accidentally may make their way in!

```{r, echo=FALSE, results='asis'}

cat(paste0("  \n## This Week's Data ", "  \n",
             keypost_df$text, "\n\n",
             case_when(is.na(keypost_df$pic_1) ~ "", 
                       TRUE ~ paste0("![](", keypost_df$pic_1,  ")\n")),
             case_when(is.na(keypost_df$pic_3) ~ "", 
                       TRUE ~ paste0("![](", keypost_df$pic_3,  ")\n")),
             case_when(is.na(keypost_df$pic_4) ~ "", 
                       TRUE ~ paste0("![](", keypost_df$pic_4,  ")")),
             "\n\n",
             "***  \n"))
```


<br>  
<br>  

```{r, echo = FALSE, fig.width=6, fig.height = 4, dpi = 650}
sum_df <- clean_df %>% 
  mutate(day = lubridate::wday(created_at, label = TRUE)) %>% 
  group_by(day) %>% 
  summarize(n = n()) 

sum_df %>% 
  ggplot(aes(day, n)) +
  #geom_segment(aes(y = 0, x = )) +
  geom_segment(aes(y = 0, x = day, xend = day, yend = n), color = ifelse(sum_df$day == "Tue", "blue", "black"), size = 1) +
  geom_point(color = ifelse(sum_df$day == "Tue", "blue", "black"), size = 3) + 
  theme_minimal() +
  #theme(axis.title.y = element_text(face = "bold")) +
  labs(y = "Number of Tweets\n",
       x = "",
       caption = "Source: rtweet | By: @thomas_mock",
       title = "#TidyTuesday Tweets by Day\n")
```

<br>  
<br>  

***  

```{r, echo=FALSE, results='asis', eval = F}
for(x in length(clean_df)) {
  cat(paste0("  \n## Submission by ", clean_df$screen_name ,"  \n",
             clean_df$text, "\n\n  ",
             case_when(is.na(clean_df$pic_1) ~ "", 
                       TRUE ~ paste0("![](", clean_df$pic_1,  ")\n")),
             case_when(is.na(clean_df$pic_2) ~ "", 
                       TRUE ~ paste0("![](", clean_df$pic_2,  ")\n")),
             case_when(is.na(clean_df$pic_3) ~ "", 
                       TRUE ~ paste0("![](", clean_df$pic_3,  ")\n")),
             case_when(is.na(clean_df$pic_4) ~ "", 
                       TRUE ~ paste0("![](", clean_df$pic_4,  ")")),
             "\n\n",
             "***  \n"))
  }
```

```{r, echo = FALSE, results = 'asis'}
for(x in length(clean_df)) {
  httr::GET(url = paste0("https://publish.twitter.com/oembed?url=https%3A%2F%2Ftwitter.com%2F", 
                       clean_df$screen_name, 
                       "%2Fstatus%2F", 
                       clean_df$status_id)) %>% 
  httr::content() %>% 
  .[["html"]] %>% 
  cat(paste0(., "\n\n"))
}
```

